function vitrinaShopCart(){return{Cart(){const t={items:[],total:0,tax:0,netTotal:0,sendingToServer:false,boxCount:0,invoiceType:"default",deliveryType:"default",perceptionTax:0,visiblePerceptionTaxValue:0,addItem(t){if(t===undefined||this.isDuplicate(t))return false;this.items.push(t);return true},removeItem(t){var i=this.items.findIndex(i=>i.equals(t));this.items.splice(i,1)},isDuplicate(t){const i=this.items.find(i=>t.equals(i));return i!==undefined},calculateTotal(){var t=0;var i=0;var e=0;if(this.items.length>0){this.items.forEach(i=>{i.calculateTotal();t+=i.total})}this.total=t+this.visiblePerceptionTaxValue},calculateTax(){this.tax=0;if(this.items.length>0){this.items.forEach(t=>{this.tax+=t.calculateTax()})}},calculateNetTotal(){this.netTotal=0;if(this.items.length>0){this.items.forEach(t=>{this.netTotal+=t.calculateNetTotal()})}},calculateBoxCount(){this.boxCount=0;if(this.items.length>0){this.items.forEach(t=>{this.boxCount+=t.quantity})}},calculatePerceptionTax(){if(this.netTotal>100){const t=100;this.visiblePerceptionTaxValue=this.netTotal*this.perceptionTax/t}else{this.visiblePerceptionTaxValue=0}},changeInvoiceType(t){this.invoiceType=t},changeDelivertyType(t){this.deliveryType=t},changePerceptionTax(t){this.perceptionTax=Number(t)},isValidInvoiceType(){return this.invoiceType!=="default"},isValidDeliveryType(){return this.deliveryType!=="default"}};return t},Item(t,i,e,a,r,s,n,c,u,o,h,l,d){var y=[];y=!t?y.concat(["matnr"]):y;y=!i?y.concat(["werks"]):y;y=!e?y.concat(["lgort"]):y;y=!a?y.concat(["charg"]):y;y=!r?y.concat(["precio"]):y;y=!s?y.concat(["currency"]):y;y=!o?y.concat(["meins"]):y;y=!d?y.concat(["iva"]):y;if(y.length>0){var m="Producto sin:";y.forEach(t=>{m+="\n"+t});throw new Error(m)}r=Number(r);u=Number(u);d=Number(d)/100;const p={matnr:t,werks:i,lgort:e,charg:a,quantity:0,unitPrice:r,total:0,discount:0,currency:s,_maxQuantity:n,description:c,netPrice:u,tax:0,displayPrice:r,discountOperator:"-",quantityUnit:o,calibre:h,marca:l,vat:d,changeQuantity(t){if(Number(t)<1||Number(t)>Number(this._maxQuantity)){this.quantity=0;throw new Error(`Minimo 1 maximo ${this._maxQuantity}`)}this.quantity=Number(t)},changeDiscount(t){this.discount=Number(t)},calculateTotal(){if(this.discount!==0){var t=this.discount;if(this.discountOperator==="-")t=t*-1;const i=this.unitPrice+t;this.total=this.quantity*i}else{this.total=this.quantity*this.unitPrice}return this.total},calculateNetTotal(){var t=0;const i=this.unitPrice/(this.currentTaxRate()+1);if(this.discount!==0){var e=this.discount;if(this.discountOperator==="-")e=e*-1;t=i+e/(this.currentTaxRate()+1);t=this.quantity*t}else{t=this.quantity*i}return t},validate(){const t={isValidQuantity:true,isValidDiscount:true};if(this.quantity===0||this.quantity<0||this.quantity>this._maxQuantity){t.isValidQuantity=false}if(this.discount<0){t.isValidDiscount=false}return t},equals(t){return this.matnr===t.matnr&&this.werks===t.werks&&this.lgort===t.lgort&&this.charg===t.charg&&this.unitPrice===t.unitPrice&&this.currency===t.currency&&this._maxQuantity===t._maxQuantity},calculateTax(){return this.calculateTotal()-this.calculateTotal()/(1+this.vat)},changeDisplayPrice(){var t=this.discount;if(this.discountOperator==="-")t=t*-1;this.displayPrice=this.unitPrice+t},changeDiscountOperator(t){if(t!=="-"&&t!=="+"){throw new Error("Operador invalido")}this.discountOperator=t},updateStock(t){if(!t)throw new Error("Invalid stock");this._maxQuantity=Number(t)},currentTaxRate(){return this.vat}};return p}}}